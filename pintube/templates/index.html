{% extends "base.html" %}

{% block content %}

<script type="text/javascript">
	var pintube_object = '{{pintube_object}}'

	function add_video_to_playlist(video_id, playlist_id) {

		pintube_object.add_video_to_playlist(video_id, playlist_id, 1)

	}

	function copy_playlist(original_playlist_url) {
		new_playlist_name = $("#playlist_name").val()

		pintube_object.copy_playlist_to(original_playlist_url, new_playlist_name)

	}

	function set_values() {
		
		
		//var add_form = {{add_form}}
		var playlist_names = $("#playlist_option").tagit("assignedTags");
		
		//debugger;

		playlist_names = JSON.stringify(playlist_names)
		//debugger;
		
		
		
		
		
		
		//debugger;
	}


</script>
<script type="text/javascript" src="/static/js/sijax/sijax.js"></script>
<script type="text/javascript">
    {{ g.sijax.get_js()|safe }}
</script>
{% macro input(name, value='', type='text') -%}
    <input type="{{ type }}" value="{{ value|e }}" name="{{ name }}">
{%- endmacro %}
<h2>PinTube</h2>
<div class="row">
	<a href="javascript://" onclick="Sijax.request('say_hi');">Click here</a>
	<div class="col-md-4">
		<div class="container">
			<div class="row">
				<div class="col-md-12 col-md-offset-0">
					<!-- Nav tabs category -->
					<ul class="nav nav-tabs faq-cat-tabs">
						<li class="active">
							<a href="#faq-cat-1" data-toggle="tab">Videos</a>
						</li>
						<li>
							<a href="#faq-cat-2" data-toggle="tab">Playlists</a>
						</li>
						<li>
							<a href="#faq-cat-3" data-toggle="tab">Subscriptions</a>
						</li>
					</ul>

					<!-- Tab panes -->
					{% if has_youtube and has_pinboard %}
					{% set youtube_data = pintube_object.youtube_data %}
					<div class="tab-content faq-cat-content">
						<div class="tab-pane active in fade" id="faq-cat-1">
							<!-- Video Table Information -->
							<!--
							<div class="alert alert-info">
							Please Wait...
							</div>
							<div class="alert alert-success" style="display:none;">
							<span class="glyphicon glyphicon-ok"></span> Drag table row and change Order
							</div>

							-->
							<table class="table table-striped table-bordered">
								<thead>
									<tr>
										<th class="td-actions"> Add Video? </th>
										<th> Pinboard Youtube Videos </th>
									</tr>
								</thead>
								<tbody>
									{% for key, value in videos.iteritems() %}
									<tr>
										<!-- Add Video to Playlist(s) -->
										<td>
										<fieldset>
											<legend>
												Select Playlists:
											</legend>
											<form id="addVideo">
												
												<div class="input-group form-group">
													<div class="input-group-btn">
														<button type="button" class="btn btn-default dropdown-toggle" id="playlistDropDown" data-toggle="dropdown">
															Current Playlists:
															<span class="caret"></span>
														</button>
														<ul class="dropdown-menu" id="playlist-add" aria-labelledby="playlistDropDown">
															{% for key2, value2 in pintube_object.youtube_data.iteritems() %}
															{% set temp = value2 %}
															<li>
																<a href="#">{{key2|e}} ({{value2["number_of_vids"]|e}})</a>
															</li>
															<li class="divider"></li>
															{% endfor %}
														</ul>
													</div>
												</div>
												<input type="text" class="form-control" id="playlist_option", name="playlist_option">
												{% set add_video_url = value["url"] %}
												
												<input type="submit" value="Add Video" class="btn btn-primary btn-lg">
												
										
												<!--
												<div class="btn-group">
													<span onclick=set_values();></span>
													
													
													<input class="btn btn-lg btn-primary" type="submit" value="Add Video" onclick="add_video();">
													
													{# 
													#}
												</div>
												-->

	<!--<a href="javascript:copy_playlist('{{value["url"]}}');" class="btn btn-primary"></a>-->
											</form>
											<script type="text/javascript">
											$(function() {
												$('#addVideo').bind('submit', function(){
													var playlist_names = $("#playlist_option").tagit("assignedTags");
													
													for (var i = 0; i < playlist_names.length; i++){
														var pname = playlist_names[i].toString()
														console.log("Entry "+ i + " => [" + pname + "]");
														//debugger;
														Sijax.request('add_video', ['{{add_video_url}}', pname]);
													}
													
													
													
													//Sijax.request('add_video', ['{{add_video_url}}', 'playlist_names']);
													
													//Prevent the form from being submitted
													return false;
												});
											});
											</script>
										</fieldset></td>
										<!-- Video -->
										<td>
										<button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myVideoModal{{loop.index}}">
											{{key}}
										</button>
										<div class="modal fade  modal-wide" id="myVideoModal{{loop.index}}" tabindex="-1" role="dialog" aria-labelledby="myVideoModalLabel{{loop.index}}" aria-hidden="true">
											<div class="modal-dialog">
												<div class="modal-content">
													<div class="modal-header">
														<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
															&times;
														</button>
														<h4 class="modal-title" id="myVideoModalLabel{{loop.index}}">{{key}}</h4>
													</div>
													<div class="modal-body">
														{{value["url"]|oembed()}}
													</div>
													<div class="modal-footer">
														<button type="button" class="btn btn-default" data-dismiss="modal">
															Close
														</button>
													</div>
												</div>
											</div>
										</div></td>
									</tr>
									{% endfor %}
								</tbody>
							</table>
						</div>

						<div class="tab-pane fade" id="faq-cat-2">
							<!-- Playlist Table Information -->
							<!--
							<div class="alert alert-info">
							Please Wait...
							</div>
							<div class="alert alert-success" style="display:none;">
							<span class="glyphicon glyphicon-ok"></span> Drag table row and change Order
							</div>
							-->
							<table class="table table-striped table-bordered">
								<thead>
									<tr>
										<th class="td-actions"> Copy Playlist? </th>
										<th> Pinboard Youtube Playlists </th>

									</tr>
								</thead>
								<tbody>

									{% for key, value in playlists.iteritems()%}
									<tr>
										<!-- Copy Playlist? -->
										<td>
										<fieldset>
											<legend>
												Title of New Playlist:
											</legend>
											<form role="form" method="post">
												{#{ input('playlist_name', value="{{key}}") }#}
												<input type="text" class="form-control" id="playlist_name", name="playlist_name" value="{{key}}">
													{% set playlist_url = value['url'] %}
													{% set playlist_name = key %}
													<!--<a href="javascript://" onclick="Sijax.request('copy_playlist', ['{{playlist_url}}', '{{input(playlist_name).value}}']);">Copy Playlist</a>-->
													<a href="javascript://" onclick="Sijax.request('copy_playlist', ['{{playlist_url}}', '{{playlist_name}}']);">Copy Playlist</a>
												
												<!--class="btn btn-primary"-->
												{#
												{ {cp_form.hidden_tag()} }
												{ % set f = cp_form.new_playlist_name.process_data(key) % }
												{ {{cp_form.new_playlist_name.data = {{key}}}} }
												{{cp_form.new_playlist_name(size=40)}}
												{% set h = cp_form.original_playlist_url.process_data(value["url"]) %}
												{ {{cp_form.original_playlist_url.data = {{value["url"]}}}} }
												<!--
												<input class="btn btn-lg btn-primary btn-block" type="submit" value="Copy Playlist" onclick="Sijax.request('copy_playlist', [{{value['url']}}, {{key}}]);">	
												<input type="text" class="form-control" id="playlist_name", name="playlist_name" value="{{pname}}">
												<div class="btn-group">
												<a href="javascript:copy_playlist('{{value["url"]}}');" class="btn btn-primary">
												<a href="#">
												Copy Playlist
												{% set playlist_name = pname %}
												{{pintube_object.copy_playlist_to(value["url"], pname)}}
												</a>

												</div>
												<input class="btn btn-lg btn-primary btn-block" type="submit" value="Copy Playlist">-->
												#}
											</form>
										</fieldset></td>
										<!-- Playlist -->
										<td>
										<button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myPlaylistModal{{loop.index}}">
											{{key}}
										</button>
										<div class="modal fade modal-wide" id="myPlaylistModal{{loop.index}}" tabindex="-1" role="dialog" aria-labelledby="myPlaylistModalLabel{{loop.index}}" aria-hidden="true">
											<div class="modal-dialog">
												<div class="modal-content">
													<div class="modal-header">
														<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
															&times;
														</button>
														<h4 class="modal-title" id="myPlaylistModalLabel{{loop.index}}">{{key}}</h4>
													</div>
													<div class="modal-body">
														{% autoescape false %}
														{{value["embed"]}}
														{% endautoescape %}
													</div>
													<div class="modal-footer">
														<button type="button" class="btn btn-default" data-dismiss="modal">
															Close
														</button>
													</div>
												</div>
											</div>
										</div></td>

									</tr>
									{% endfor %}
								</tbody>
							</table>

						</div>
						<div class="tab-pane fade" id="faq-cat-3">
							<!-- Subscription Table Information -->
							<!--
							<div class="alert alert-info">
							Please Wait...
							</div>
							<div class="alert alert-success" style="display:none;">
							<span class="glyphicon glyphicon-ok"></span> Drag table row and change Order
							</div>
							-->
							<table class="table table-striped table-bordered">
								<thead>
									<tr>
										<th> Pinboard Youtube Subscriptions </th>
									</tr>
								</thead>
								<tbody>
									{% for key, value in subscriptions.iteritems()%}
									<tr>
										<!-- Subscription -->
										<td> {% autoescape false %}
										{{value["embed"]}}
										{% endautoescape %} </td>
									</tr>
									{% endfor %}
								</tbody>
							</table>
						</div>
					</div>
					{% endif %}
				</div>
			</div>
		</div>
	</div>
	<div class="col-md-4"></div>
	<div class="col-md-4"></div>

</div>
{% endblock %}